<html>
    <head>
        <title>Login</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<!--===============================================================================================-->	
	<link rel="icon" type="image/png" href="images/icons/favicon.png"/>
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/linearicons-v1.0.0/icon-font.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/perfect-scrollbar/perfect-scrollbar.css">
<!--===============================================================================================-->

	<link rel="stylesheet" type="text/css" href="css/main.css">
<!--===============================================================================================-->
        <style>
            body {
            margin: 0;
            padding: 0;
            background-color: #17a2b8;
            height: 100vh;
            }
            #login .container #login-row #login-column #login-box {
            margin-top: 120px;
            max-width: 600px;
            height: 320px;
            border: 1px solid #9C9C9C;
            background-color: #EAEAEA;
            }
            #login .container #login-row #login-column #login-box #login-form {
            padding: 20px;
            }
            #login .container #login-row #login-column #login-box #login-form #register-link {
            margin-top: -85px;
            }
        </style>

        </head>
        
       
        <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <!------ Include the above in your HEAD tag ---------->
        <!-- Header -->
		<header class="header-v4">
            <!-- Header desktop -->
            <div class="container-menu-desktop">
                <!-- Topbar -->
                <div class="top-bar">
                    <div class="content-topbar flex-sb-m h-full container">
                        
                      
                    </div>
                </div>
    
                <div class="wrap-menu-desktop how-shadow1">
                    <nav class="limiter-menu-desktop container">
                        
                        <!-- Logo desktop -->		
                        <a href="index.html" class="logo">
                            <img src="images/TutorLab_Logo.png" alt="IMG-LOGO">
                        </a>
    
                        <!-- Menu desktop -->
                        <div class="menu-desktop">
                            <ul class="main-menu">
                                <li>
                                    <a href="index.html">Home</a>
                                </li>
    
    
                                <li class="label1" data-label1="hot">
                                    <a href="alltutor.html">Tutor</a>
                                </li>
    
                                <li>
                                    <a href="appointment.html">Appointment</a>
                                </li>
    
                            </ul>
                        </div>	
    
  
                    </nav>
                </div>	
            </div>
    
            <!-- Header Mobile -->
            <div class="wrap-header-mobile">
            
                <!-- Logo moblie -->		
                <div class="logo-mobile">
                    <a href="index.html"><img src="images/TutorLab_Logo.png" alt="IMG-LOGO"></a>
                </div>
  
    
                <!-- Button show menu -->
                <div class="btn-show-menu-mobile hamburger hamburger--squeeze">
                    <span class="hamburger-box">
                        <span class="hamburger-inner"></span>
                    </span>
                </div>
            </div>
    
    
            <!-- Menu Mobile -->
            <div class="menu-mobile">
                <ul class="topbar-mobile">
    
                    <li>
                        <div class="right-top-bar flex-w h-full">
                                <a href="#" id="setCID" class="flex-c-m trans-04 p-lr-25" onclick="SetID()">
                             Login with Customer ID
                          </a>
    
                            <a href="#" class="flex-c-m trans-04 p-lr-25">
                                EN
                            </a>
    
                            <a href="#" class="flex-c-m trans-04 p-lr-25">
                                SGD
                            </a>
                        </div>
                    </li>
                </ul>
    
                <ul class="main-menu-m">
                    <li>
                        <a href="index.html">Home</a>
                    </li>
    
    
                    <li class="label1" data-label1="hot">
                        <a href="alltutor.html">Tutor</a>
                    </li>
    
                    <li>
                        <a href="appointment.html">Appointment</a>
                    </li>
                    
                </ul>
            </div>
    
            <!-- Modal Search -->
            <div class="modal-search-header flex-c-m trans-04 js-hide-modal-search">
                <div class="container-search-header">
                    <button class="flex-c-m btn-hide-modal-search trans-04 js-hide-modal-search">
                        <img src="images/icons/icon-close2.png" alt="CLOSE">
                    </button>
    
                </div>
            </div>
        </header>
    
    
        <body>
            <div id="login">
                <h3 class="text-center text-white pt-5">Login form</h3>
                <div class="container">
                    <div id="login-row" class="row justify-content-center align-items-center">
                        <div id="login-column" class="col-md-6">
                            <div id="login-box" class="col-md-12">
                                <form action="" id="login-form" class="form"method="post">
                                    <h3 class="text-center text-info">Login</h3>
                                    <div class="form-group">
                                        <label for="username" class="text-info">Username:</label><br>
                                        <input type="text" name="username" id="username" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <label for="password" class="text-info">Password:</label><br>
                                        <input type="password" name="password" id="password" class="form-control">
                                    </div>
                                    <div class="form-group">
                                        <br>
                                        <input type="submit" name="submit" class="btn btn-info btn-md" value="submit">
                                    </div>
                                    <div id="register-link" class="text-right">
                                        <a href="signup.html" class="text-info">Register here</a>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            

            <script>
                function showError(message) {     
                    // Display an error under the main container
                    $('#main-container')
                        .append("<label>"+message+"</label>");
                }
                $("#login-form").submit(async (event) => {  //Prevents screen from refreshing when submitting  
                    event.preventDefault();
                    
                    var username = $('#username').val();
                    var serviceURL = "http://localhost:8000/account";

                try {
                        
                        const response =
                        await fetch(
                        serviceURL, { method: 'GET' }
                        );
                       // const data = await response.json();
                        
                       // var accounts = data; //the arr is in data.books of the JSON data
                        //console.log(accounts);
                        const data = await response.json();
                        
                        var accounts = data; //the arr is in data.books of the JSON data
                        var number = 0;
                        //console.log(accounts)
                        for(var index in accounts) {
                            //console.log(accounts[index][0]["username"])
                            //console.log(username)
                            for (i = 0; i < accounts[index].length; i++) {
                                if (accounts[index][i]["username"]==username){
                                   // console.log(i)
                                    number = i;
                                }
                                 
                            }
                        }
                        //console.log(number)
                        
                        //console.log(tutors);
                        // array or array.length are falsy
                        if (accounts["Accounts"][number]['customerID'].length==0) {
                            showError('Incorrect Username or password! Please try again!')
                        } else {
                            sessionStorage.setItem("CID", accounts["Accounts"][number]['customerID']);
                            sessionStorage.setItem("name", accounts["Accounts"][number]['name']);
                            //console.log(sessionStorage.getItem("CID"));
                            alert("Welcome "+accounts["Accounts"][number]['name']+"!");
                            window.location.replace("index.html");   
                        }
                        
                        

                    }catch (error) {
                    // Errors when calling the service; such as network error, 
                    // service offline, etc
                    // showError
                    // ('There is a problem retrieving books data, please try again later.<br />'+error);
    
    } // error
            });
               
                
               
    
</script>


            
        </body>


</html>

